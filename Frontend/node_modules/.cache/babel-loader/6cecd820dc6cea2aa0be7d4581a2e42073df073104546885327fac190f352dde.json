{"ast":null,"code":"// src/services/CartService.js\nimport CartModel from '../models/CartModel.js';\nimport api from './api';\nclass CartService {\n  constructor() {\n    this.localCart = new CartModel(JSON.parse(localStorage.getItem('cart')) || []);\n    this.isAuthenticated = false;\n    this.userId = null;\n  }\n  setAuth(isAuthenticated, userId) {\n    this.isAuthenticated = isAuthenticated;\n    this.userId = userId;\n  }\n  async syncWithServer() {\n    if (!this.isAuthenticated) return;\n    try {\n      const res = await api.get('/cart');\n      const serverItems = res.data.cart.items;\n      this.localCart = new CartModel(serverItems);\n      localStorage.setItem('cart', JSON.stringify(serverItems));\n    } catch (error) {\n      console.error('Lỗi đồng bộ giỏ hàng:', error);\n    }\n  }\n  async saveToServer(items) {\n    if (!this.isAuthenticated) return;\n    try {\n      const promises = items.map(item => api.post('/cart/add', {\n        productId: item.id,\n        quantity: item.quantity\n      }));\n      await Promise.all(promises);\n    } catch (error) {\n      console.error('Lỗi lưu giỏ hàng:', error);\n    }\n  }\n  addToCart(product) {\n    const updated = this.localCart.addItem(product);\n    localStorage.setItem('cart', JSON.stringify(updated));\n    this.saveToServer(updated);\n    return updated;\n  }\n  removeFromCart(productId) {\n    const updated = this.localCart.removeItem(productId);\n    localStorage.setItem('cart', JSON.stringify(updated));\n    if (this.isAuthenticated) {\n      api.delete(`/cart/remove/${productId}`).catch(() => {});\n    }\n    return updated;\n  }\n  updateQuantity(productId, quantity) {\n    const updated = this.localCart.updateQuantity(productId, quantity);\n    localStorage.setItem('cart', JSON.stringify(updated));\n    if (this.isAuthenticated) {\n      api.put('/cart/update', {\n        productId,\n        quantity\n      }).catch(() => {});\n    }\n    return updated;\n  }\n  clearCart() {\n    const updated = this.localCart.clear();\n    localStorage.setItem('cart', JSON.stringify(updated));\n    if (this.isAuthenticated) {\n      api.delete('/cart/clear').catch(() => {});\n    }\n    return updated;\n  }\n  getCartItems() {\n    return this.localCart.getItems();\n  }\n  getTotalPrice() {\n    return this.localCart.totalPrice;\n  }\n}\nexport default CartService;","map":{"version":3,"names":["CartModel","api","CartService","constructor","localCart","JSON","parse","localStorage","getItem","isAuthenticated","userId","setAuth","syncWithServer","res","get","serverItems","data","cart","items","setItem","stringify","error","console","saveToServer","promises","map","item","post","productId","id","quantity","Promise","all","addToCart","product","updated","addItem","removeFromCart","removeItem","delete","catch","updateQuantity","put","clearCart","clear","getCartItems","getItems","getTotalPrice","totalPrice"],"sources":["D:/Hoang.bk/Documents/GitHub/HHSHOP/Frontend/src/services/CartService.js"],"sourcesContent":["// src/services/CartService.js\r\nimport CartModel from '../models/CartModel.js';\r\nimport api from './api';\r\n\r\nclass CartService {\r\n  constructor() {\r\n    this.localCart = new CartModel(JSON.parse(localStorage.getItem('cart')) || []);\r\n    this.isAuthenticated = false;\r\n    this.userId = null;\r\n  }\r\n\r\n  setAuth(isAuthenticated, userId) {\r\n    this.isAuthenticated = isAuthenticated;\r\n    this.userId = userId;\r\n  }\r\n\r\n  async syncWithServer() {\r\n    if (!this.isAuthenticated) return;\r\n    try {\r\n      const res = await api.get('/cart');\r\n      const serverItems = res.data.cart.items;\r\n      this.localCart = new CartModel(serverItems);\r\n      localStorage.setItem('cart', JSON.stringify(serverItems));\r\n    } catch (error) {\r\n      console.error('Lỗi đồng bộ giỏ hàng:', error);\r\n    }\r\n  }\r\n\r\n  async saveToServer(items) {\r\n    if (!this.isAuthenticated) return;\r\n    try {\r\n      const promises = items.map(item => \r\n        api.post('/cart/add', { productId: item.id, quantity: item.quantity })\r\n      );\r\n      await Promise.all(promises);\r\n    } catch (error) {\r\n      console.error('Lỗi lưu giỏ hàng:', error);\r\n    }\r\n  }\r\n\r\n  addToCart(product) {\r\n    const updated = this.localCart.addItem(product);\r\n    localStorage.setItem('cart', JSON.stringify(updated));\r\n    this.saveToServer(updated);\r\n    return updated;\r\n  }\r\n\r\n  removeFromCart(productId) {\r\n    const updated = this.localCart.removeItem(productId);\r\n    localStorage.setItem('cart', JSON.stringify(updated));\r\n    if (this.isAuthenticated) {\r\n      api.delete(`/cart/remove/${productId}`).catch(() => {});\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  updateQuantity(productId, quantity) {\r\n    const updated = this.localCart.updateQuantity(productId, quantity);\r\n    localStorage.setItem('cart', JSON.stringify(updated));\r\n    if (this.isAuthenticated) {\r\n      api.put('/cart/update', { productId, quantity }).catch(() => {});\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  clearCart() {\r\n    const updated = this.localCart.clear();\r\n    localStorage.setItem('cart', JSON.stringify(updated));\r\n    if (this.isAuthenticated) {\r\n      api.delete('/cart/clear').catch(() => {});\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  getCartItems() {\r\n    return this.localCart.getItems();\r\n  }\r\n\r\n  getTotalPrice() {\r\n    return this.localCart.totalPrice;\r\n  }\r\n}\r\n\r\nexport default CartService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}