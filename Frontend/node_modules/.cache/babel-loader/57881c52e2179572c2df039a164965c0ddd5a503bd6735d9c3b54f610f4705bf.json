{"ast":null,"code":"// src/services/CartService.js\nimport CartModel from '../models/CartModel.js';\nimport api from './api';\nclass CartService {\n  constructor() {\n    this.localCart = new CartModel(JSON.parse(localStorage.getItem('cart')) || []);\n    this.isAuthenticated = false;\n    this.userId = null;\n  }\n  setAuth(userId) {\n    this.isAuthenticated = true;\n    this.userId = userId;\n    this.syncWithBackend(); // TỰ ĐỘNG ĐỒNG BỘ KHI LOGIN\n  }\n  async syncWithBackend() {\n    if (!this.isAuthenticated) return;\n    try {\n      const res = await api.get('/cart');\n      const serverItems = res.data.cart.items.map(i => ({\n        ...i.productId,\n        quantity: i.quantity\n      }));\n      this.saveToLocal(serverItems);\n    } catch (error) {\n      console.error('Sync failed:', error);\n    }\n  }\n  async addToCart(product) {\n    const updated = this.localCart.addItem(product);\n    this.saveToLocal(updated);\n    if (this.isAuthenticated) {\n      await api.post('/cart/add', {\n        productId: product.id\n      });\n    }\n    return updated;\n  }\n  async removeFromCart(id) {\n    const updated = this.localCart.removeItem(id);\n    this.saveToLocal(updated);\n    if (this.isAuthenticated) {\n      await api.delete(`/cart/remove/${id}`);\n    }\n    return updated;\n  }\n  async updateQuantity(id, qty) {\n    const updated = this.localCart.updateQuantity(id, qty);\n    this.saveToLocal(updated);\n    if (this.isAuthenticated) {\n      await api.put('/cart/update', {\n        productId: id,\n        quantity: qty\n      });\n    }\n    return updated;\n  }\n  async clearCart() {\n    const updated = this.localCart.clear();\n    this.saveToLocal(updated);\n    if (this.isAuthenticated) {\n      await api.delete('/cart/clear');\n    }\n    return updated;\n  }\n  saveToLocal(items) {\n    localStorage.setItem('cart', JSON.stringify(items));\n    this.localCart = new CartModel(items);\n  }\n  getCartItems() {\n    return this.localCart.getItems();\n  }\n  getTotalPrice() {\n    return this.localCart.totalPrice;\n  }\n}\nexport default new CartService();","map":{"version":3,"names":["CartModel","api","CartService","constructor","localCart","JSON","parse","localStorage","getItem","isAuthenticated","userId","setAuth","syncWithBackend","res","get","serverItems","data","cart","items","map","i","productId","quantity","saveToLocal","error","console","addToCart","product","updated","addItem","post","id","removeFromCart","removeItem","delete","updateQuantity","qty","put","clearCart","clear","setItem","stringify","getCartItems","getItems","getTotalPrice","totalPrice"],"sources":["D:/Hoang.bk/Documents/GitHub/HHSHOP/Frontend/src/services/CartService.js"],"sourcesContent":["// src/services/CartService.js\r\nimport CartModel from '../models/CartModel.js';\r\nimport api from './api';\r\n\r\nclass CartService {\r\n  constructor() {\r\n    this.localCart = new CartModel(JSON.parse(localStorage.getItem('cart')) || []);\r\n    this.isAuthenticated = false;\r\n    this.userId = null;\r\n  }\r\n\r\n  setAuth(userId) {\r\n    this.isAuthenticated = true;\r\n    this.userId = userId;\r\n    this.syncWithBackend(); // TỰ ĐỘNG ĐỒNG BỘ KHI LOGIN\r\n  }\r\n\r\n  async syncWithBackend() {\r\n    if (!this.isAuthenticated) return;\r\n    try {\r\n      const res = await api.get('/cart');\r\n      const serverItems = res.data.cart.items.map(i => ({\r\n        ...i.productId,\r\n        quantity: i.quantity\r\n      }));\r\n      this.saveToLocal(serverItems);\r\n    } catch (error) {\r\n      console.error('Sync failed:', error);\r\n    }\r\n  }\r\n\r\n  async addToCart(product) {\r\n    const updated = this.localCart.addItem(product);\r\n    this.saveToLocal(updated);\r\n\r\n    if (this.isAuthenticated) {\r\n      await api.post('/cart/add', { productId: product.id });\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  async removeFromCart(id) {\r\n    const updated = this.localCart.removeItem(id);\r\n    this.saveToLocal(updated);\r\n\r\n    if (this.isAuthenticated) {\r\n      await api.delete(`/cart/remove/${id}`);\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  async updateQuantity(id, qty) {\r\n    const updated = this.localCart.updateQuantity(id, qty);\r\n    this.saveToLocal(updated);\r\n\r\n    if (this.isAuthenticated) {\r\n      await api.put('/cart/update', { productId: id, quantity: qty });\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  async clearCart() {\r\n    const updated = this.localCart.clear();\r\n    this.saveToLocal(updated);\r\n\r\n    if (this.isAuthenticated) {\r\n      await api.delete('/cart/clear');\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  saveToLocal(items) {\r\n    localStorage.setItem('cart', JSON.stringify(items));\r\n    this.localCart = new CartModel(items);\r\n  }\r\n\r\n  getCartItems() { return this.localCart.getItems(); }\r\n  getTotalPrice() { return this.localCart.totalPrice; }\r\n}\r\n\r\nexport default new CartService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}